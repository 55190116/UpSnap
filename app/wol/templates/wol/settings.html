{% load static %}

<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>UpSnap</title>
    <link rel="icon" type="image/png" href="{% static 'img/favicon.png' %}">
    <link rel="stylesheet" href="{% static 'css/bulma.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/bulma-prefers-dark.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/all.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="{% static 'css/bulma-notifications.css' %}">
</head>

<body>
    <nav class="navbar" role="navigation" aria-label="main navigation">
        <div class="navbar-brand">
            <a class="navbar-item" href="/">
                <img class="ml-2" src="{% static 'img/favicon.png' %}" width="28" height="28">
            </a>
            <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="navbarBasicExample">
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
            </a>
        </div>
        <div id="navbarBasicExample" class="navbar-menu">
            <div class="navbar-start">
                <a class="navbar-item" href="/">
                    Devices
                </a>
                <a class="navbar-item" href="/settings/">
                    Settings
                </a>
            </div>
        </div>
    </nav>
    <div class="container">
        <section class="section">
            <h1 class="title is-size-2">Settings</h1>
            <p class="subtitle">UpSnap</p>
        </section>
        <section class="section py-3">
            <h2 class="title is-size-3 my-5">General</h2>
            <form action="/settings/save/" method="post">
                {% csrf_token %}
                <div class="box no-flex">
                    <div class="columns">
                        <div class="column is-one-quarter">
                            <span class="mr-2"><strong>Notifications:</strong></span>
                        </div>
                        <div class="column is-one-quarter">
                            <div class="control">
                                <label class="radio">
                                    <input id="noti-on" type="radio" name="notifications" value="on" {% if settings.enable_notifications %}checked{% endif %}>
                                    Enabled
                                </label>
                                <label class="radio">
                                    <input id="noti-off" type="radio" name="notifications" value="off" {% if not settings.enable_notifications %}checked{% endif %}>
                                    Disabled
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="columns">
                        <div class="column is-one-quarter">
                            <span class="mr-2"><strong>Console logging:</strong></span>
                        </div>
                        <div class="column is-one-quarter">
                            <div class="control">
                                <label class="radio">
                                    <input id="console-on" type="radio" name="console" value="on" {% if settings.enable_console_logging %}checked{% endif %}>
                                    Enabled
                                </label>
                                <label class="radio">
                                    <input id="console-off" type="radio" name="console" value="off" {% if not settings.enable_console_logging %}checked{% endif %}>
                                    Disabled
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="columns">
                        <div class="column is-one-quarter">
                            <span class="mr-2"><strong>Sort devices by:</strong></span>
                        </div>
                        <div class="column is-one-quarter">
                            <div class="control">
                                <label class="radio">
                                    <input id="sort-name" type="radio" name="sort" value="name" {% if settings.sort_by == "name" %}checked{% endif %}>
                                    Name
                                </label>
                                <label class="radio">
                                    <input id="sort-ip" type="radio" name="sort" value="ip" {% if settings.sort_by == "ip" %}checked{% endif %}>
                                    IP
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="columns">
                        <div class="column is-one-quarter">
                            <label class="mr-2" for="ip-range"><strong>Network address for discovering devices:</strong></label>
                        </div>
                        <div class="column is-one-quarter is-narrow">
                            <input id="ip-range" class="input" type="text" placeholder="192.168.1.0/24" name="ip_range" value="{% if settings.scan_address %}{{ settings.scan_address }}{% endif %}" pattern="^([01]?\d\d?|2[0-4]\d|25[0-5])(?:\.(?:[01]?\d\d?|2[0-4]\d|25[0-5])){2}(?:\.(?:0))(?:/[0-2]\d|/3[0-2])$">
                        </div>
                    </div>
                    <button class="button is-primary" type="submit" value="Submit">
                        <span class="icon is-small">
                            <i class="fas fa-save"></i>
                        </span>
                        <span>
                            Save
                        </span>
                    </button>
                </div>
            </form>
        </section>
        <section class="section py-3">
            <h2 class="title is-size-3 my-5">Manage Devices</h2>
            <div class="box no-flex">
                <h3 class="title is-size-4 mb-5">Scan network</h3>
                {% if settings.scan_address %}
                <button id="scan-button" class="button is-primary">
                    <span class="icon is-small">
                        <i class="fas fa-network-wired"></i>
                    </span>
                    <span>
                        Scan
                    </span>
                </button>
                {% else %}
                <article class="message is-danger">
                    <div class="message-body">
                        Please enter the network address above and save to use this feature. Network address should look like "192.168.1.0/24".
                    </div>
                </article>
                <button id="scan-button" class="button is-primary" disabled>
                    <span class="icon is-small">
                        <i class="fas fa-network-wired"></i>
                    </span>
                    <span>
                        Scan
                    </span>
                </button>
                {% endif %}
                <h3 class="title is-size-4 my-5">Add devices</h3>
                <form action="/settings/custom_add/" method="post">
                    {% csrf_token %}
                    <table class="table is-fullwidth">
                        <thead>
                            <th class="w-20">Name</th>
                            <th class="w-20">IP</th>
                            <th class="w-20">Netmask</th>
                            <th class="w-20">MAC</th>
                            <th class="w-20">Action</th>
                        </thead>
                        <tbody>
                            <td class="is-vcentered">
                                <input type="text" class="input" name="custom_add_name">
                            </td>
                            <td class="is-vcentered">
                                <input type="text" class="input" name="custom_add_ip">
                            </td>
                            <td class="is-vcentered">
                                <input type="text" class="input" name="custom_add_netmask" value="{{ netmask }}">
                            </td>
                            <td class="is-vcentered">
                                <input type="text" class="input" name="custom_add_mac">
                            </td>
                            <td class="is-vcentered">
                                <button id="btn-custom-add" class="button is-primary is-small" type="submit">Add</button>
                            </td>
                        </tbody>
                    </table>
                </form>
                <div id="scan-table-container" class="table-container is-hidden">
                    <table id="scan-table" class="table is-fullwidth">
                        <tbody></tbody>
                    </table>
                </div>
                {% if devices %}
                <h3 class="title is-size-4 my-5">Edit devices</h3>
                <div class="table-container">
                    <table class="table is-fullwidth">
                        <thead>
                            <th class="w-20">Name</th>
                            <th class="w-20">IP</th>
                            <th class="w-20">Netmask</th>
                            <th class="w-20">MAC</th>
                            <th class="w-20">Action</th>
                        </thead>
                        <tbody>
                            {% for dev in devices %}
                            <tr>
                                <td id="dev-name" data-id="{{ dev.id }}" class="is-vcentered">
                                    <div id="dev-name-label-container" data-id="{{ dev.id }}">
                                        {{ dev.name }}
                                    </div>
                                    <div id="dev-name-input-container" data-id="{{ dev.id }}" class="is-hidden">
                                        <input id="dev-name-input" data-id="{{ dev.id }}" type="text" class="input" value="{{ dev.name }}">
                                    </div>
                                </td>
                                <td id="dev-ip" data-id="{{ dev.id }}" class="is-vcentered">
                                    <div id="dev-ip-label-container" data-id="{{ dev.id }}">
                                        {{ dev.ip }}
                                    </div>
                                    <div id="dev-ip-input-container" data-id="{{ dev.id }}" class="is-hidden">
                                        <input id="dev-ip-input" data-id="{{ dev.id }}" type="text" class="input" value="{{ dev.ip }}">
                                    </div>
                                </td>
                                <td id="dev-netmask" data-id="{{ dev.id }}" class="is-vcentered">
                                    <div id="dev-netmask-label-container" data-id="{{ dev.id }}">
                                        {{ dev.netmask }}
                                    </div>
                                    <div id="dev-netmask-input-container" data-id="{{ dev.id }}" class="is-hidden">
                                        <input id="dev-netmask-input" data-id="{{ dev.id }}" type="text" class="input" value="{{ dev.netmask }}">
                                    </div>
                                </td>
                                <td id="dev-mac" data-id="{{ dev.id }}" class="is-vcentered">
                                    {{ dev.mac }}
                                </td>
                                <td>
                                    <div class="buttons">
                                        <button id="save-button" class="button is-primary is-small is-hidden" data-id="{{ dev.id }}">
                                            Save
                                        </button>
                                        <button id="edit-button" class="button is-warning is-small" data-id="{{ dev.id }}">
                                            Edit
                                        </button>
                                        <button id="delete-button" class="button is-danger is-small" data-id="{{ dev.id }}">
                                            Delete
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% endif %}
                <h3 class="title is-size-4 my-5">Backup / Restore</h3>
                <div class="columns is-tablet">
                    <div class="column is-narrow">
                        <a class="button is-primary" href="/settings/export/">
                            <span class="icon is-small">
                                <i class="fas fa-download"></i>
                            </span>
                            <span>Backup devices</span>
                        </a>
                    </div>
                    <div class="column is-narrow">
                        <form action="/settings/import/" method="post" enctype=multipart/form-data id="restore-form">
                            {% csrf_token %}
                            <div class="file is-primary">
                                <label class="file-label">
                                    <input id="restore-input" class="file-input" type="file" name="file" accept=".json" onchange="form.submit()">
                                    <span class="file-cta">
                                        <span class="file-icon">
                                            <i class="fas fa-upload"></i>
                                        </span>
                                        <span class="file-label">
                                            Restore from file…
                                        </span>
                                    </span>
                                </label>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </section>
        <section class="section py-3 mb-6">
            <h2 class="title is-size-3 my-5">Info</h2>
            <div class="box no-flex">
                <div class="columns">
                    <div class="column">
                        <h3 class="title is-size-4 mb-5">App</h3>
                        <div class="columns is-mobile">
                            <div class="column">
                                <span class="mr-2"><strong>App version:</strong></span>
                            </div>
                            <div class="column">
                                <p>{{ app_version }}</p>
                            </div>
                        </div>
                        <div class="columns is-mobile">
                            <div class="column">
                                <span class="mr-2"><strong>Ping interval:</strong></span>
                            </div>
                            <div class="column">
                                <p>{{ ping_interval }} seconds</p>
                            </div>
                        </div>
                        <div class="columns is-mobile">
                            <div class="column">
                                <span class="mr-2"><strong>Devices in database:</strong></span>
                            </div>
                            <div class="column">
                                <p>{{ devices|length }}</p>
                            </div>
                        </div>
                        <div class="columns is-mobile">
                            <div class="column">
                                <span class="mr-2"><strong>Current visitors:</strong></span>
                            </div>
                            <div class="column">
                                <p>{{ visitors }}</p>
                            </div>
                        </div>
                        <div class="columns is-mobile">
                            <div class="column">
                                <span class="mr-2"><strong>Debug mode:</strong></span>
                            </div>
                            <div class="column">
                                <p>{{ debug }}</p>
                            </div>
                        </div>
                    </div>
                    <div class="column">
                        <h3 class="title is-size-4 mb-5">System</h3>
                        <div class="columns is-mobile">
                            <div class="column">
                                <span class="mr-2"><strong>System:</strong></span>
                            </div>
                            <div class="column">
                                <p>{{ platform.system }}</p>
                            </div>
                        </div>
                        <div class="columns is-mobile">
                            <div class="column">
                                <span class="mr-2"><strong>Node:</strong></span>
                            </div>
                            <div class="column">
                                <p>{{ platform.node }}</p>
                            </div>
                        </div>
                        <div class="columns is-mobile">
                            <div class="column">
                                <span class="mr-2"><strong>Release:</strong></span>
                            </div>
                            <div class="column">
                                <p>{{ platform.release }}</p>
                            </div>
                        </div>
                        <div class="columns is-mobile">
                            <div class="column">
                                <span class="mr-2"><strong>Version:</strong></span>
                            </div>
                            <div class="column">
                                <p>{{ platform.version }}</p>
                            </div>
                        </div>
                        <div class="columns is-mobile">
                            <div class="column">
                                <span class="mr-2"><strong>Machine:</strong></span>
                            </div>
                            <div class="column">
                                <p>{{ platform.machine }}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
</body>

<footer>
    <script src="{% static 'js/bulma.js' %}"></script>
    <script src="{% static 'js/settings.js' %}"></script>
</footer>

</html>
